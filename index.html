<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Citas Gavabarber</title>
<style>
body { font-family: Arial, sans-serif; background: #f0f0f0; padding: 20px; text-align:center; }
h1 { color:#222; margin-bottom:20px; }
button { padding: 10px 16px; border:none; border-radius:6px; cursor:pointer; background:#2196f3; color:white; margin:5px; font-size:16px; }
button:hover { background:#1976d2; }
#counter { font-weight:bold; }

table { width:100%; border-collapse: collapse; margin-top:10px; text-align:center; }
th, td { border:1px solid #ccc; padding:0; height:35px; }
th { background:#2196f3; color:white; }
td.slot { min-width:80px; position:relative; }
td.slot input { width: 100%; height: 100%; border:none; padding:5px; box-sizing:border-box; text-align:center; font-size:14px; background:transparent; }
td.libre input { background:#c8e6c9; cursor:text; }
td.ocupado input { background:#ef9a9a; cursor:text; }
td.ocupado-filtro input { background:#b0b0b0; cursor:not-allowed; }
td.pasado input { background:#e0e0e0; cursor:not-allowed; }
td.libre:hover input { background:#a5d6a7; }
td.ocupado:hover input { background:#ef6c6c; }
td.ocupado-filtro:hover input { background:#999999; }
thead th.dia { background: #bbdefb; color: #0d47a1; font-weight: bold; }

.week-nav { display:flex; justify-content:center; align-items:center; gap:10px; margin-bottom:10px; flex-wrap:wrap; }
.controls { display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; margin-bottom:10px; gap:10px; }
.buttons-left, .buttons-right { display:flex; gap:10px; align-items:center; }

#loginScreen { display:flex; flex-direction:column; align-items:center; justify-content:center; height:60vh; }
#loginBtn { font-size:20px; padding:12px 20px; }

@media (max-width: 768px) {
  table { display:block; overflow-x:auto; white-space:nowrap; }
  th, td { padding:0 5px; font-size:14px; min-width:60px; height:30px; }
  button { padding:6px 10px; font-size:14px; }
  .controls { flex-direction:column; align-items:flex-start; gap:5px; }
}
</style>
</head>
<body>

<h1>Citas Gavabarber</h1>

<!-- Pantalla de login -->
<div id="loginScreen">
  <h2>Inicia sesión para reservar tu cita</h2>
  <button id="loginBtn">Iniciar sesión con Google</button>
</div>

<!-- Pantalla de calendario -->
<div id="calendarScreen" style="display:none;">
  <div class="week-nav">
    <button id="prevWeek">← Semana anterior</button>
    <span id="weekLabel">Semana actual</span>
    <button id="nextWeek">Semana siguiente →</button>
  </div>

  <div class="controls">
    <div class="buttons-left">
      <button id="showAll">Mostrar todas las citas</button>
      <button id="showFree">Mostrar solo libres</button>
    </div>
    <div class="buttons-right">
      <button id="logoutBtn" style="display:none;">Cerrar sesión</button>
      <div id="counter">Clientes agendados: 0</div>
    </div>
  </div>

  <table id="calendar">
    <thead><tr><th>Hora</th></tr></thead>
    <tbody></tbody>
  </table>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAjXrpMMKPMc9KsrpZ_ymv8CMAKME8l0Fs",
  authDomain: "agenda-barberia-59b4c.firebaseapp.com",
  databaseURL: "https://agenda-barberia-59b4c-default-rtdb.firebaseio.com",
  projectId: "agenda-barberia-59b4c",
  storageBucket: "agenda-barberia-59b4c.firebasestorage.app",
  messagingSenderId: "541388928781",
  appId: "1:541388928781:web:89db455c12f67b3fee6244",
  measurementId: "G-LG0DL5RXP0"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

let userLoggedIn = false;
const dias=["Lunes","Martes","Miércoles","Jueves","Viernes","Sábado","Domingo"];
const horas=[];
for(let h=9;h<=20;h++){ horas.push(h+":00"); horas.push(h+":30"); }

const table=document.getElementById("calendar");
const thead=table.querySelector("thead tr");
const tbody=table.querySelector("tbody");
const counterDiv=document.getElementById("counter");
const weekLabel = document.getElementById("weekLabel");
const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");

let showOnlyFree=false;
let currentMonday = getMonday(new Date());

function getMonday(d){
  const date = new Date(d);
  const day = date.getDay();
  const diff = (day === 0 ? -6 : 1) - day;
  date.setDate(date.getDate() + diff);
  date.setHours(0,0,0,0);
  return date;
}

// Aquí continúa toda la lógica de crearTabla(), actualizarHeader(), actualizarEstado(), cargarSemana(), filtros y navegación...
// (Mantén el código que ya tenías para manejar slots, firebase y autenticación)

loginBtn.onclick = ()=>{
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider).catch(error=>{
    alert("Error al iniciar sesión: " + error.message);
  });
};

logoutBtn.onclick = ()=>{
  auth.signOut().catch(error=>{
    alert("Error al cerrar sesión: " + error.message);
  });
};

auth.onAuthStateChanged(user=>{
  userLoggedIn = !!user;
  document.getElementById("loginScreen").style.display = userLoggedIn ? "none" : "block";
  document.getElementById("calendarScreen").style.display = userLoggedIn ? "block" : "none";
  logoutBtn.style.display = userLoggedIn ? "inline-block" : "none";
  cargarSemana();
});
</script>
</body>
</html>
